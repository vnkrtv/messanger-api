variables:
  # dind has some issues with internal supervisor
  TESTCONTAINERS_RYUK_DISABLED: "true"
  # Provide image to tests
  IMAGE_NAME: $CI_REGISTRY_IMAGE

tests:
  stage: test
  image: docker:20.10
  tags:
    - docker
  script:
    - apk --no-cache add openjdk11 --repository=http://dl-cdn.alpinelinux.org/alpine/edge/community
    - apk add curl wget git tar unzip ca-certificates gradle=6.8.3-r1
    - docker build -f ./docker/app.dockerfile -t $IMAGE_NAME .        # build docker image for app
    - gradle test -i                                                  # run tests, AUTH_DISABLED: "true"